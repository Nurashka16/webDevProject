<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞ #5 ‚Äî –¢–æ—Å—Ç—ã</title>
    <script>
      (function () {
        const saved = localStorage.getItem("theme") || "light";
        document.documentElement.setAttribute("data-theme", saved);
      })();
    </script>
    <link rel="stylesheet" href="../css/reset.css" />
    <link rel="stylesheet" href="../css/variables.css" />
    <link rel="stylesheet" href="../css/main.css" />
    <link rel="stylesheet" href="./index.css" />
    <link rel="stylesheet" href="./tasks/task1/task1.css" />
    <link rel="stylesheet" href="./tasks/task2/task2.css" />
    <link rel="stylesheet" href="./tasks/task3/task3.css" />
    <link rel="stylesheet" href="./tasks/task4/task4.css" />
  </head>
  <body>
    <script src="./header.js"></script>

    <main class="main">
      <div class="lab-content">
        <div class="title">
          <h1>–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞ #5</h1>
          <p>Fetch</p>
        </div>

        <!-- –ó–∞–¥–∞—á–∞ 1: –¢–æ—Å—Ç -->
        <div class="task task1">
          <h3>1. –¢–æ—Å—Ç</h3>
          <p>
            –°–æ–∑–¥–∞–π—Ç–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –≤—Å–ø–ª—ã–≤–∞—é—â–µ–≥–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (toasts), –∫–æ—Ç–æ—Ä—ã–π
            –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤–Ω–∏–∑—É —Å–ø—Ä–∞–≤–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –ø–ª–∞–≤–Ω–æ
            –ø–æ—è–≤–ª—è—Ç—å—Å—è –∏ –∏—Å—á–µ–∑–∞—Ç—å, –∏–º–µ—Ç—å —Ä–∞–∑–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –æ—à–∏–±–∫–∏ (–∫—Ä–∞—Å–Ω—ã–π) –∏
            —Å–æ–æ–±—â–µ–Ω–∏—è (–∑–µ–ª—ë–Ω—ã–π), –∑–∞–∫—Ä—ã–≤–∞—Ç—å—Å—è –ø–æ –∫–Ω–æ–ø–∫–µ, –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã–º –∏
            –æ—Ç–∑—ã–≤—á–∏–≤—ã–º.
          </p>

          <div class="solution-wrapper">
            <h3 class="solution-title">–†–µ—à–µ–Ω–∏–µ:</h3>
            <div class="task-solution task1-solution">
              <button id="showSuccessToast" class="solve-btn">
                –ü–æ–∫–∞–∑–∞—Ç—å —É—Å–ø–µ—à–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
              </button>
              <button id="showErrorToast" class="solve-btn error-btn">
                –ü–æ–∫–∞–∑–∞—Ç—å –æ—à–∏–±–∫—É
              </button>
              <div class="result-output">
                <pre id="jobResult">
–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –¥–ª—è –≤—ã–∑–æ–≤–∞ toasts ‚Äî —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ—è–≤–∏—Ç—Å—è –≤–Ω–∏–∑—É</pre
                >
              </div>
            </div>
          </div>

          <div class="solution-wrapper">
            <h3 class="solution-title">–ö–æ–¥ —Ñ—É–Ω–∫—Ü–∏–∏:</h3>
            <button
              id="toggleCodeBtn1"
              class="toggle-code-btn"
              onclick="toggleFunctionCode('functionCode1', 'toggleCodeBtn1')"
            >
              –ü–æ–∫–∞–∑–∞—Ç—å –∫–æ–¥
            </button>
            <pre id="functionCode1" class="code-block hidden">
// –ü–æ–∫–∞–∑ —Ç–æ—Å—Ç–∞
function showToast(message, type = 'success') {
    let container = document.getElementById('toast-container');
    if (!container) {
        container = document.createElement('div');
        container.id = 'toast-container';
        container.setAttribute('aria-live', 'polite');
        container.setAttribute('aria-atomic', 'true');
        document.body.appendChild(container);
    }

    const toast = document.createElement('div');
    toast.className = `toast ${type}`;
    toast.setAttribute('role', 'alert');
    toast.innerHTML = `
        <span>${message}</span>
        <button class="close-toast" aria-label="–ó–∞–∫—Ä—ã—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ">&times;</button>
    `;
    container.appendChild(toast);

    setTimeout(() => toast.classList.add('show'), 10);

    const closeToast = () => {
        toast.classList.remove('show');
        setTimeout(() => {
            toast.remove();
            if (container.children.length === 0) {
                container.remove();
            }
        }, 300);
    };

    toast.querySelector('.close-toast').addEventListener('click', closeToast);
    const autoCloseTimer = setTimeout(closeToast, 4000);
    const cancelAutoClose = () => {
        clearTimeout(autoCloseTimer);
        toast.removeEventListener('mouseenter', cancelAutoClose);
        toast.removeEventListener('focusin', cancelAutoClose);
    };
    toast.addEventListener('mouseenter', cancelAutoClose);
    toast.addEventListener('focusin', cancelAutoClose);
}

// –ò–º–∏—Ç–∞—Ü–∏—è API
async function mockApiCall(isSuccess) {
    await new Promise(resolve => setTimeout(resolve, 600));
    if (isSuccess) {
        return { message: "–û–ø–µ—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!" };
    } else {
        throw new Error("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∑–∞–ø—Ä–æ—Å–∞.");
    }
}

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
document.addEventListener('DOMContentLoaded', () => {
    const resultEl = document.getElementById('jobResult');

    document.getElementById('showSuccessToast')?.addEventListener('click', async () => {
        try {
            const { message } = await mockApiCall(true);
            showToast(message, 'success');
            resultEl.textContent = '‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–∫–∞–∑–∞–Ω–æ –≤–Ω–∏–∑—É';
        } catch (err) {
            showToast('–ù–µ–æ–∂–∏–¥–∞–Ω–Ω–∞—è –æ—à–∏–±–∫–∞', 'error');
            resultEl.textContent = '‚ö†Ô∏è –û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è';
        }
    });

    document.getElementById('showErrorToast')?.addEventListener('click', async () => {
        try {
            await mockApiCall(false);
        } catch (err) {
            showToast(err.message, 'error');
            resultEl.textContent = '‚ùå –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ –ø–æ–∫–∞–∑–∞–Ω–æ';
        }
    });
});</pre>
          </div>
        </div>

        <!-- –ó–∞–¥–∞—á–∞ 2: –ì–∞–ª–µ—Ä–µ—è -->
        <div class="task task3">
          <h3>2. –ì–∞–ª–µ—Ä–µ—è</h3>
          <p>
            –ò—Å–ø–æ–ª—å–∑—É—è AJAX, –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å –Ω–∞
            –ø–æ–ª—É—á–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏ –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å –∏—Ö –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ. –ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–∞—é—Ç
            –æ—à–∏–±–∫–∏ ‚Äî —Å–¥–µ–ª–∞—Ç—å –¥–æ 3 –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ —Å –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–º. –ü—Ä–∏ –ø–æ–ª–Ω–æ–º
            –ø—Ä–æ–≤–∞–ª–µ ‚Äî –æ–ø–æ–≤–µ—Å—Ç–∏—Ç—å —á–µ—Ä–µ–∑ —Ç–æ—Å—Ç. –í–æ –≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å
            –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä. –ï—Å–ª–∏ –ø—Ä–∏—à—ë–ª –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å "–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–µ
            –Ω–∞–π–¥–µ–Ω—ã".
          </p>

          <div class="solution-wrapper">
            <h3 class="solution-title">–†–µ—à–µ–Ω–∏–µ:</h3>
            <div class="task-solution task3-solution">
              <div class="result-output">
                <pre id="galleryResult">
–î–ª—è –Ω–æ–≤—ã—Ö –∫–∞—Ä—Ç–∏–Ω–æ–∫ –Ω–∞–∂–º–∏—Ç–µ "–æ–±–Ω–æ–≤–∏—Ç—å"</pre
                >
              </div>

              <div id="galleryContainer" class="gallery-container"></div>

              <button id="refreshGalleryBtn" class="refresh-btn">
                –û–±–Ω–æ–≤–∏—Ç—å –≥–∞–ª–µ—Ä–µ—é
              </button>
            </div>
          </div>

          <div class="solution-wrapper">
            <h3 class="solution-title">–ö–æ–¥ —Ñ—É–Ω–∫—Ü–∏–∏:</h3>
            <button
              id="toggleCodeBtn3"
              class="toggle-code-btn"
              onclick="toggleFunctionCode('functionCode3', 'toggleCodeBtn3')"
            >
              –ü–æ–∫–∞–∑–∞—Ç—å –∫–æ–¥
            </button>
            <pre id="functionCode3" class="code-block hidden">
// –°–º. —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –≤ lab5/tasks/task4/task4.js</pre
            >
          </div>
        </div>

        <!-- –ó–∞–¥–∞—á–∞ 3: –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ -->
        <div class="task task2">
          <h3>3. –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≤ –∫–ª–∞—Å—Å–µ</h3>
          <p>
            –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–≤–µ–¥–µ–Ω–∏—è –æ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–µ –≤ –∫–ª–∞—Å—Å–µ. –§–æ—Ä–º–∞ –¥–æ–ª–∂–Ω–∞ –≤–∫–ª—é—á–∞—Ç—å
            –Ω–æ–º–µ—Ä –∞—É–¥–∏—Ç–æ—Ä–∏–∏ –∏ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É. –ü—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç—å
            —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Ñ–æ—Ä–º—ã, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Fetch API –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏
            POST-–∑–∞–ø—Ä–æ—Å–∞.
          </p>

          <div class="solution-wrapper">
            <h3 class="solution-title">–†–µ—à–µ–Ω–∏–µ:</h3>
            <div class="task-solution task2-solution">
              <form id="temperatureForm" class="temp-form">
                <div class="form-group">
                  <label for="classroom" class="form-label"
                    >–ù–æ–º–µ—Ä –∞—É–¥–∏—Ç–æ—Ä–∏–∏:</label
                  >
                  <input
                    type="text"
                    id="classroom"
                    name="classroom"
                    class="form-input"
                    placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: Tip-1315"
                    required
                    aria-required="true"
                  />
                </div>

                <div class="form-group">
                  <label for="temperature" class="form-label"
                    >–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ (¬∞C):</label
                  >
                  <input
                    type="number"
                    id="temperature"
                    name="temperature"
                    class="form-input"
                    step="0.1"
                    placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 20.5"
                    required
                    aria-required="true"
                  />
                </div>

                <button type="submit" id="submitTempBtn" class="submit-btn">
                  –û—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
                </button>
              </form>

              <div class="result-output">
                <pre id="tempResult">
–í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –∏ –Ω–∞–∂–º–∏—Ç–µ "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ"</pre
                >
              </div>
            </div>
          </div>

          <div class="solution-wrapper">
            <h3 class="solution-title">–ö–æ–¥ —Ñ—É–Ω–∫—Ü–∏–∏:</h3>
            <button
              id="toggleCodeBtn2"
              class="toggle-code-btn"
              onclick="toggleFunctionCode('functionCode2', 'toggleCodeBtn2')"
            >
              –ü–æ–∫–∞–∑–∞—Ç—å –∫–æ–¥
            </button>
            <pre id="functionCode2" class="code-block hidden">
async function handleTemperatureSubmit(event) {
    event.preventDefault();
    const form = event.target;
    const submitBtn = document.getElementById('submitTempBtn');
    const resultElement = document.getElementById('tempResult');
    const classroom = document.getElementById('classroom').value.trim();
    const temperature = parseFloat(document.getElementById('temperature').value);

    if (!classroom) {
        showToast('‚ùå –í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –∞—É–¥–∏—Ç–æ—Ä–∏–∏', 'error');
        document.getElementById('classroom').focus();
        return;
    }
    if (isNaN(temperature)) {
        showToast('‚ùå –í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É', 'error');
        document.getElementById('temperature').focus();
        return;
    }

    submitBtn.disabled = true;
    resultElement.textContent = 'üîÑ –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö...';

    try {
        const response = await fetch('http://95.163.242.125/temp', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ class: classroom, temp: temperature })
        });

        const data = await response.json();
        if (!response.ok) throw new Error(data.message || `–û—à–∏–±–∫–∞: ${response.status}`);

        if (data.status === 'ok') {
            showToast('‚úÖ ' + data.message, 'success');
            resultElement.textContent = '‚úÖ ' + data.message;
            form.reset();
        } else {
            throw new Error(data.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞');
        }
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏:', error);
        showToast('‚ùå ' + error.message, 'error');
        resultElement.textContent = '‚ùå ' + error.message;
    } finally {
        submitBtn.disabled = false;
    }
}</pre
            >
          </div>
        </div>
        <!-- –ó–∞–¥–∞—á–∞ 4: –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–µ–º—ã -->
        <div class="task task4">
          <h3>4. –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–µ–º—ã</h3>
          <p>
            –†–µ–∞–ª–∏–∑—É–π—Ç–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É —Å–≤–µ—Ç–ª–æ–π –∏ —Ç—ë–º–Ω–æ–π —Ç–µ–º–æ–π. –ü–µ—Ä–≤–∞—è –∫–Ω–æ–ø–∫–∞
            –≤ —à–∞–ø–∫–µ —É–ø—Ä–∞–≤–ª—è–µ—Ç –≤—Å–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ–π. –í—Ç–æ—Ä–∞—è –∫–Ω–æ–ø–∫–∞ –Ω–∏–∂–µ ‚Äî —Ç–æ–ª—å–∫–æ —ç—Ç–∏–º
            –±–ª–æ–∫–æ–º. –í—ã–±–æ—Ä —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ localStorage.
          </p>

          <div class="solution-wrapper">
            <h3 class="solution-title">–†–µ—à–µ–Ω–∏–µ:</h3>
            <div style="gap: 15px" class="task-solution task4-solution">
              <div class="result-output">
                <pre id="tempResult">
–î–ª—è —Å–º–µ–Ω—ã —Ç–µ–º—ã –Ω–∞–∂–º–∏—Ç–µ –ø—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É</pre
                >
              </div>

              <button id="localThemeToggle" class="theme-toggle-btn2">
                –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É
              </button>
            </div>
          </div>

          <div class="solution-wrapper">
            <h3 class="solution-title">–ö–æ–¥ —Ñ—É–Ω–∫—Ü–∏–∏:</h3>
            <button
              id="toggleCodeBtn4"
              class="toggle-code-btn"
              onclick="toggleFunctionCode('functionCode4', 'toggleCodeBtn4')"
            >
              –ü–æ–∫–∞–∑–∞—Ç—å –∫–æ–¥
            </button>
            <pre id="functionCode4" class="code-block hidden">
// –°–º. —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –≤ tasks/task4/task4.js</pre
            >
          </div>
        </div>
      </div>
    </main>

    <script src="../partials/footer.js"></script>
    <script src="./index.js"></script>
    <script src="../index.js"></script>
    <script src="./tasks/task1/task1.js"></script>
    <script src="./tasks/task2/task2.js"></script>
    <script src="./tasks/task3/task3.js"></script>
    <script src="./tasks/task4/task4.js"></script>
  </body>
</html>
